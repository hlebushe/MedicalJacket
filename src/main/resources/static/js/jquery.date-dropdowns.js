!function(e,t,a,n){"use strict";var i={defaultDate:null,defaultDateFormat:"yyyy-mm-dd",displayFormat:"dmy",submitFormat:"yyyy-mm-dd",minAge:0,maxAge:120,minYear:null,maxYear:null,submitFieldName:"date",wrapperClass:"date-dropdowns",dropdownClass:null,daySuffixes:!0,monthSuffixes:!0,monthFormat:"long",required:!1,dayLabel:"Day",monthLabel:"Month",yearLabel:"Year",monthLongValues:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShortValues:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],initialDayMonthYearValues:["Day","Month","Year"],daySuffixValues:["st","nd","rd","th"]};function s(t,a){return this.element=t,this.$element=e(t),this.config=e.extend({},i,a),this.internals={objectRefs:{}},this.init(),this}e.extend(s.prototype,{init:function(){this.checkForDuplicateElement(),this.setInternalVariables(),this.setupMarkup(),this.buildDropdowns(),this.attachDropdowns(),this.bindChangeEvent(),this.config.defaultDate&&this.populateDefaultDate()},checkForDuplicateElement:function(){return!e('input[name="'+this.config.submitFieldName+'"]').length||(e.error("Duplicate element found"),!1)},setInternalVariables:function(){var e=new Date;this.internals.currentDay=e.getDate(),this.internals.currentMonth=e.getMonth()+1,this.internals.currentYear=e.getFullYear()},setupMarkup:function(){var t,a;if("input"===this.element.tagName.toLowerCase()){this.config.defaultDate||(this.config.defaultDate=this.element.value),a=this.$element.attr("type","hidden").wrap('<div class="'+this.config.wrapperClass+'"></div>');var n=this.config.submitFieldName!==i.submitFieldName;this.element.hasAttribute("name")||n?n&&this.$element.attr("name",this.config.submitFieldName):this.$element.attr("name",i.submitFieldName),t=this.$element.parent()}else a=e("<input/>",{type:"hidden",name:this.config.submitFieldName}),this.$element.append(a).addClass(this.config.wrapperClass),t=this.$element;return this.internals.objectRefs.pluginWrapper=t,this.internals.objectRefs.hiddenField=a,!0},buildDropdowns:function(){var e,t,a;return s.message={day:this.config.initialDayMonthYearValues[0],month:this.config.initialDayMonthYearValues[1],year:this.config.initialDayMonthYearValues[2]},e=this.buildDayDropdown(),this.internals.objectRefs.dayDropdown=e,t=this.buildMonthDropdown(),this.internals.objectRefs.monthDropdown=t,a=this.buildYearDropdown(),this.internals.objectRefs.yearDropdown=a,!0},attachDropdowns:function(){var e=this.internals.objectRefs.pluginWrapper,t=this.internals.objectRefs.dayDropdown,a=this.internals.objectRefs.monthDropdown,n=this.internals.objectRefs.yearDropdown;switch(this.config.displayFormat){case"mdy":e.append(a,t,n);break;case"ymd":e.append(n,a,t);break;case"dmy":default:e.append(t,a,n)}return!0},bindChangeEvent:function(){var e=this.internals.objectRefs.dayDropdown,t=this.internals.objectRefs.monthDropdown,a=this.internals.objectRefs.yearDropdown,n=this,i=this.internals.objectRefs;i.pluginWrapper.on("change","select",function(){var s,r,o=e.val(),l=t.val(),d=a.val();if(s=n.checkDate(o,l,d))return i.dayDropdown.addClass("invalid"),!1;"00"!==i.dayDropdown.val()&&i.dayDropdown.removeClass("invalid"),i.hiddenField.val(""),s||o*l*d==0||(r=n.formatSubmitDate(o,l,d),i.hiddenField.val(r)),i.hiddenField.change()})},populateDefaultDate:function(){var e=this.config.defaultDate,t=[],a="",n="",i="";switch(this.config.defaultDateFormat){case"yyyy-mm-dd":default:a=(t=e.split("-"))[2],n=t[1],i=t[0];break;case"dd/mm/yyyy":a=(t=e.split("/"))[0],n=t[1],i=t[2];break;case"mm/dd/yyyy":a=(t=e.split("/"))[1],n=t[0],i=t[2];break;case"unix":(t=new Date).setTime(1e3*e),a=t.getDate()+"",n=t.getMonth()+1+"",i=t.getFullYear(),a.length<2&&(a="0"+a),n.length<2&&(n="0"+n)}return this.internals.objectRefs.dayDropdown.val(a),this.internals.objectRefs.monthDropdown.val(n),this.internals.objectRefs.yearDropdown.val(i),this.internals.objectRefs.hiddenField.val(e),!0===this.checkDate(a,n,i)&&this.internals.objectRefs.dayDropdown.addClass("invalid"),!0},buildBaseDropdown:function(t){var a=t;return this.config.dropdownClass&&(a+=" "+this.config.dropdownClass),e("<select></select>",{class:a,name:this.config.submitFieldName+"_["+t+"]",required:this.config.required})},buildDayDropdown:function(){var e,t=this.buildBaseDropdown("day"),n=a.createElement("option");n.setAttribute("value",""),n.appendChild(a.createTextNode(this.config.dayLabel)),t.append(n);for(var i=1;i<10;i++)e=this.config.daySuffixes?i+this.getSuffix(i):"0"+i,(n=a.createElement("option")).setAttribute("value","0"+i),n.appendChild(a.createTextNode(e)),t.append(n);for(var s=10;s<=31;s++)e=s,this.config.daySuffixes&&(e=s+this.getSuffix(s)),(n=a.createElement("option")).setAttribute("value",s),n.appendChild(a.createTextNode(e)),t.append(n);return t},buildMonthDropdown:function(){var e=this.buildBaseDropdown("month"),t=a.createElement("option");t.setAttribute("value",""),t.appendChild(a.createTextNode(this.config.monthLabel)),e.append(t);for(var n=1;n<=12;n++){var i;switch(this.config.monthFormat){case"short":i=this.config.monthShortValues[n-1];break;case"long":i=this.config.monthLongValues[n-1];break;case"numeric":i=n,this.config.monthSuffixes&&(i+=this.getSuffix(n))}n<10&&(n="0"+n),(t=a.createElement("option")).setAttribute("value",n),t.appendChild(a.createTextNode(i)),e.append(t)}return e},buildYearDropdown:function(){var e=this.config.minYear,t=this.config.maxYear,n=this.buildBaseDropdown("year"),i=a.createElement("option");i.setAttribute("value",""),i.appendChild(a.createTextNode(this.config.yearLabel)),n.append(i),e||(e=this.internals.currentYear-(this.config.maxAge+1)),t||(t=this.internals.currentYear-this.config.minAge);for(var s=t;s>=e;s--)(i=a.createElement("option")).setAttribute("value",s),i.appendChild(a.createTextNode(s)),n.append(i);return n},getSuffix:function(e){var t="",a=this.config.daySuffixValues[0],n=this.config.daySuffixValues[1],i=this.config.daySuffixValues[2],s=this.config.daySuffixValues[3];switch(e%10){case 1:t=e%100==11?s:a;break;case 2:t=e%100==12?s:n;break;case 3:t=e%100==13?s:i;break;default:t="th"}return t},checkDate:function(e,t,a){var n;if("00"!==t){var i=new Date(a,t,0).getDate(),s=parseInt(e,10);(n=this.updateDayOptions(i,s))&&this.internals.objectRefs.hiddenField.val("")}return n},updateDayOptions:function(e,t){var n=parseInt(this.internals.objectRefs.dayDropdown.children(":last").val(),10),i="",s="",r=!1;if(n>e){for(;n>e;)this.internals.objectRefs.dayDropdown.children(":last").remove(),n--;t>e&&(r=!0)}else if(n<e)for(;n<e;){s=i=++n,this.config.daySuffixes&&(s+=this.getSuffix(n));var o=a.createElement("option");o.setAttribute("value",i),o.appendChild(a.createTextNode(s)),this.internals.objectRefs.dayDropdown.append(o)}return r},formatSubmitDate:function(e,t,a){var n,i;switch(this.config.submitFormat){case"unix":(i=new Date).setDate(e),i.setMonth(t-1),i.setYear(a),n=Math.round(i.getTime()/1e3);break;default:n=this.config.submitFormat.replace("dd",e).replace("mm",t).replace("yyyy",a)}return n},destroy:function(){var e=this.config.wrapperClass;if(this.$element.hasClass(e))this.$element.empty();else{var t=this.$element.parent().find("select");this.$element.unwrap(),t.remove()}}}),e.fn.dateDropdowns=function(t){return this.each(function(){if("string"==typeof t){var a=Array.prototype.slice.call(arguments,1),n=e.data(this,"plugin_dateDropdowns");if(void 0===n)return e.error("Please initialize the plugin before calling this method."),!1;n[t].apply(n,a)}else e.data(this,"plugin_dateDropdowns")||e.data(this,"plugin_dateDropdowns",new s(this,t))}),this}}(jQuery,window,document);